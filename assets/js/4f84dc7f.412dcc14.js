"use strict";(self.webpackChunkserenity_js_org=self.webpackChunkserenity_js_org||[]).push([[689],{7062:(e,t,n)=>{n.r(t),n.d(t,{PlaywrightVersion:()=>c,assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"integration/gitlab-ci","title":"GitLab CI","description":"Serenity/JS offers excellent support for GitLab CI:","source":"@site/src/docs/handbook/integration/gitlab-ci.mdx","sourceDirName":"integration","slug":"/integration/gitlab-ci","permalink":"/handbook/integration/gitlab-ci","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-js/serenity-js.org/tree/main/src/docs/handbook/integration/gitlab-ci.mdx","tags":[],"version":"current","lastUpdatedAt":1769814564000,"frontMatter":{"title":"GitLab CI"},"sidebar":"docs","previous":{"title":"GitHub Codespaces","permalink":"/handbook/integration/github-codespaces"},"next":{"title":"Jenkins CI","permalink":"/handbook/integration/jenkins-ci"}}');var r=n(74848),s=n(28453);const o={title:"GitLab CI"},a="GitLab CI",l={},c=()=>{const{SupportedIntegrationVersion:e}=(0,s.R)()||{};return e||u("SupportedIntegrationVersion",!0),(0,r.jsx)(e,{name:"playwright-core",format:"exact"})},h=[{value:"Before you start",id:"before-you-start",level:2},{value:"Running Serenity/JS on GitLab CI",id:"running-serenityjs-on-gitlab-ci",level:2},{value:"Configuring GitLab CI pipelines",id:"configuring-gitlab-ci-pipelines",level:2},{value:"Generating JUnit reports",id:"generating-junit-reports",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{DynamicCodeBlock:n}=t;return n||u("DynamicCodeBlock",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"gitlab-ci",children:"GitLab CI"})}),"\n",(0,r.jsxs)(t.p,{children:["Serenity/JS offers excellent support for ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/topics/build_your_application/",children:"GitLab CI"}),":\nyou can run your acceptance tests in CI, generate rich Serenity BDD reports,\nand publish both living documentation and JUnit-style test results."]}),"\n",(0,r.jsxs)(t.p,{children:["In this guide, you'll learn how to configure your GitLab CI pipeline to use the official ",(0,r.jsx)(t.a,{href:"/handbook/integration/docker/",children:"Serenity/JS Docker image"}),"\nand ensure a stable environment for running your Serenity/JS test scenarios."]}),"\n",(0,r.jsx)(t.h2,{id:"before-you-start",children:"Before you start"}),"\n",(0,r.jsxs)(t.p,{children:["Set up a working Serenity/JS test suite using one of the official ",(0,r.jsx)(t.a,{href:"/handbook/project-templates/",children:"Serenity/JS Project Templates"}),",\nor add Serenity/JS to your existing project by following the ",(0,r.jsx)(t.a,{href:"/handbook/installation/",children:"Serenity/JS installation guide"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["If you're new to Serenity/JS, ",(0,r.jsx)(t.a,{href:"/handbook/tutorials/your-first-web-scenario",children:"follow the tutorial"})," to learn more about the framework."]}),"\n",(0,r.jsx)(t.h2,{id:"running-serenityjs-on-gitlab-ci",children:"Running Serenity/JS on GitLab CI"}),"\n",(0,r.jsxs)(t.p,{children:["GitLab CI executes pipelines inside ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ee/ci/docker/using_docker_images.html",children:"Docker containers"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"To ensure stability of your execution environment, use a container with:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The latest Long-Term Support (LTS) version of ",(0,r.jsx)(t.a,{href:"https://github.com/nodejs/Release",children:"Node.js"})]}),"\n",(0,r.jsx)(t.li,{children:"A recent Java Runtime Environment (JRE)"}),"\n",(0,r.jsxs)(t.li,{children:["Your desired web browsers and other dependencies, as per the ",(0,r.jsx)(t.a,{href:"/handbook/installation/",children:"Serenity/JS installation guide"})]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The easiest way to do that is to:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Use the official ",(0,r.jsx)(t.a,{href:"/handbook/integration/docker/",children:"Serenity/JS Docker image"})," directly, as it comes pre-configured with all the required dependencies"]}),"\n",(0,r.jsxs)(t.li,{children:["Create a ",(0,r.jsx)(t.a,{href:"/handbook/integration/docker/#extending-serenityjs-docker-images",children:"custom Docker container"})," based on the official Serenity/JS Docker image to suit your needs"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"configuring-gitlab-ci-pipelines",children:"Configuring GitLab CI pipelines"}),"\n",(0,r.jsxs)(t.p,{children:["GitLab CI pipelines are configured using a file called ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ci/yaml/",children:(0,r.jsx)(t.code,{children:".gitlab-ci.yml"})}),", located at the root of your repository."]}),"\n",(0,r.jsx)(t.p,{children:"A typical Serenity/JS GitLab CI pipeline consists of at least two stages:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"test"})," - responsible for running your Serenity/JS test scenarios and collecting their artifacts"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"publish"})," - responsible for publishing artifacts, such as the Serenity reports, to GitLab Pages or other destinations"]}),"\n"]}),"\n",(0,r.jsx)(t.admonition,{title:"Pipeline naming conventions",type:"tip",children:(0,r.jsxs)(t.p,{children:["Neither GitLab CI nor Serenity/JS force you to use any particular naming convention or structure for your pipelines.\nIn this guide, we use ",(0,r.jsx)(t.code,{children:"test"})," and ",(0,r.jsx)(t.code,{children:"publish"})," as that's a great starting point and a convention often followed by teams using Serenity/JS."]})}),"\n",(0,r.jsxs)(t.p,{children:["In the example below, you see the ",(0,r.jsx)(t.code,{children:"test"})," stage with a job called ",(0,r.jsx)(t.code,{children:"serenity"})," that:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Uses the official ",(0,r.jsx)(t.a,{href:"/handbook/integration/docker/#serenityjs-playwright-image",children:"Serenity/JS Playwright Docker image"})]}),"\n",(0,r.jsxs)(t.li,{children:["Installs the project dependencies using ",(0,r.jsx)(t.code,{children:"npm ci"}),", which is the recommended way to install Node.js modules in CI environments"]}),"\n",(0,r.jsxs)(t.li,{children:["Runs the test suite using ",(0,r.jsx)(t.code,{children:"npm test"})," - all ",(0,r.jsx)(t.a,{href:"/handbook/project-templates/",children:"Serenity/JS Project Templates"})," are pre-configured to run tests and generate reports via this standard script,\nand you can adjust it to your needs if necessary"]}),"\n",(0,r.jsxs)(t.li,{children:["Preserves any artifacts under ",(0,r.jsx)(t.code,{children:"target"}),", including the Serenity BDD reports, so that they can be reused in subsequent stages of the pipeline"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"publish"})," stage has a job called ",(0,r.jsx)(t.code,{children:"create-pages"})," that:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Declares a dependency on the ",(0,r.jsx)(t.code,{children:"serenity"})," job to access its artifacts"]}),"\n",(0,r.jsxs)(t.li,{children:["Uses the ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ci/yaml/#pages",children:(0,r.jsx)(t.code,{children:"pages"})})," keyword to specify the location of the report"]}),"\n",(0,r.jsxs)(t.li,{children:["Uses the ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ci/yaml/#rules",children:(0,r.jsx)(t.code,{children:"rules"})})," keyword to publish the reports only when the pipeline runs on the default branch. This helps to avoid overwriting the main branch report when working on feature branches"]}),"\n"]}),"\n",(0,r.jsxs)(n,{title:".gitlab-ci.yml",lang:"yaml",children:["stages:\n- test\n- publish\n\nserenity:\n  stage: test\n\n  # Use the official Serenity/JS Docker image\n  image: ghcr.io/serenity-js/playwright:v",(0,r.jsx)(c,{}),'-noble\n\n  script:\n  - npm ci\n  - npm test\n\n  # Preserve test artifacts, even when the job fails\n  artifacts:\n    when: always\n    paths:\n      - target\n\ncreate-pages:\n  stage: publish\n  pages:\n    publish: target/site/serenity\n\n  dependencies:\n    - serenity\n\n  script:\n    - echo "Publishing Serenity reports"\n\n  # Publish reports to GitLab Pages only on the default branch\n  rules:\n    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\n\n# other configuration\n']}),"\n",(0,r.jsxs)(t.p,{children:["If your team uses merge requests in your workflow, you might want to use ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/user/project/pages/parallel_deployments/",children:"GitLab Parallel Deployments"}),"\nto publish an instance of Serenity reports per merge request."]}),"\n",(0,r.jsx)(t.h2,{id:"generating-junit-reports",children:"Generating JUnit reports"}),"\n",(0,r.jsxs)(t.p,{children:["GitLab CI recognises test execution reports that conform to the ",(0,r.jsx)(t.a,{href:"https://llg.cubic.org/docs/junit/",children:"JUnit XML standard"}),".\nSerenity/JS integrates with all the ",(0,r.jsx)(t.strong,{children:"native reporters"})," offered by the supported ",(0,r.jsx)(t.a,{href:"/handbook/test-runners/",children:"test runners"}),",\nincluding the ones producing JUnit reports, such as:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://github.com/cucumber/cucumber-js/blob/main/docs/formatters.md#junit",children:"Cucumber.js JUnit formatter"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.npmjs.com/package/jasmine-reporters",children:"Jasmine JUnit reporter"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.npmjs.com/package/mocha-junit-reporter",children:"Mocha JUnit reporter"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://playwright.dev/docs/test-reporters#junit-reporter",children:"Playwright Test JUnit reporter"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://webdriver.io/docs/junit-reporter/",children:"WebdriverIO"})}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["To make GitLab CI recognise a JUnit-standard report produced by your Serenity/JS test suite and ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ee/ci/testing/unit_test_reports.html",children:"surface test results in your Merge Requests"}),", you should:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Use a native JUnit reporter appropriate for your test runner"}),"\n",(0,r.jsxs)(t.li,{children:["Configure ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ee/ci/testing/unit_test_reports.html",children:(0,r.jsx)(t.code,{children:"artifacts:reports:junit"})}),"  to tell GitLab where to find the report."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["For example, if you have configured your JUnit reporter to produce a report at ",(0,r.jsx)(t.code,{children:"target/junit-results.xml"}),", you can configure your GitLab CI job as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title=".gitlab-ci.yml"',children:"stages:\n  - test\n\nserenity:\n  stage: test\n  # ...\n  artifacts:\n    when: always\n    paths:\n      - target\n    # highlight-start\n    reports:\n      junit: target/junit-results.xml\n    # highlight-end\n\n# other configuration\n"})}),"\n",(0,r.jsx)(t.admonition,{title:"Pro Tip",type:"tip",children:(0,r.jsxs)(t.p,{children:["Note that in the above example I use ",(0,r.jsx)(t.a,{href:"https://docs.gitlab.com/ee/ci/yaml/#artifactswhen",children:(0,r.jsx)(t.code,{children:"artifacts:when: always"})}),".\nThis instructs GitLab to upload and analyse the test report even when the test run fails, which is exactly when you need your test reports the most \ud83d\ude0a"]})})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(96540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);